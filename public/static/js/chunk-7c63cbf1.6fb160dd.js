(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7c63cbf1"],{"09f4":function(t,e,n){"use strict";n.d(e,"a",(function(){return o})),Math.easeInOutQuad=function(t,e,n,a){return t/=a/2,t<1?n/2*t*t+e:(t--,-n/2*(t*(t-2)-1)+e)};var a=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)}}();function i(t){document.documentElement.scrollTop=t,document.body.parentNode.scrollTop=t,document.body.scrollTop=t}function s(){return document.documentElement.scrollTop||document.body.parentNode.scrollTop||document.body.scrollTop}function o(t,e,n){var o=s(),r=t-o,l=20,u=0;e="undefined"===typeof e?500:e;var c=function t(){u+=l;var s=Math.easeInOutQuad(u,o,r,e);i(s),u<e?a(t):n&&"function"===typeof n&&n()};c()}},"2b9a":function(t,e,n){"use strict";n.d(e,"b",(function(){return i})),n.d(e,"c",(function(){return s})),n.d(e,"a",(function(){return o})),n.d(e,"d",(function(){return r}));var a=n("b775");function i(t){return Object(a["a"])({url:"/api/v1/admin/stead",method:"get",params:t})}function s(t){return Object(a["a"])({url:"/api/v1/article/pv",method:"get",params:{pv:t}})}function o(t){return Object(a["a"])({url:"/api/v1/article/create",method:"post",data:t})}function r(t){return Object(a["a"])({url:"/api/v1/article/update",method:"post",data:t})}},"44af":function(t,e,n){"use strict";n.d(e,"b",(function(){return i})),n.d(e,"c",(function(){return s})),n.d(e,"d",(function(){return o})),n.d(e,"a",(function(){return r}));var a=n("b775");function i(t){return Object(a["a"])({url:"/api/v1/admin/voting",method:"get",params:t})}function s(t){return Object(a["a"])({url:"/api/v1/admin/voting/"+t,method:"get"})}function o(t,e){return Object(a["a"])({url:"/api/v1/admin/voting/"+e,method:"put",data:t})}function r(t){return Object(a["a"])({url:"/api/v1/admin/voting",method:"post",data:t})}},"4b3a":function(t,e,n){},"62e3":function(t,e,n){"use strict";var a=n("4b3a"),i=n.n(a);i.a},"667e":function(t,e,n){"use strict";var a=n("c507"),i=n.n(a);i.a},6724:function(t,e,n){"use strict";n("8d41");var a="@@wavesContext";function i(t,e){function n(n){var a=Object.assign({},e.value),i=Object.assign({ele:t,type:"hit",color:"rgba(0, 0, 0, 0.15)"},a),s=i.ele;if(s){s.style.position="relative",s.style.overflow="hidden";var o=s.getBoundingClientRect(),r=s.querySelector(".waves-ripple");switch(r?r.className="waves-ripple":(r=document.createElement("span"),r.className="waves-ripple",r.style.height=r.style.width=Math.max(o.width,o.height)+"px",s.appendChild(r)),i.type){case"center":r.style.top=o.height/2-r.offsetHeight/2+"px",r.style.left=o.width/2-r.offsetWidth/2+"px";break;default:r.style.top=(n.pageY-o.top-r.offsetHeight/2-document.documentElement.scrollTop||document.body.scrollTop)+"px",r.style.left=(n.pageX-o.left-r.offsetWidth/2-document.documentElement.scrollLeft||document.body.scrollLeft)+"px"}return r.style.backgroundColor=i.color,r.className="waves-ripple z-active",!1}}return t[a]?t[a].removeHandle=n:t[a]={removeHandle:n},n}var s={bind:function(t,e){t.addEventListener("click",i(t,e),!1)},update:function(t,e){t.removeEventListener("click",t[a].removeHandle,!1),t.addEventListener("click",i(t,e),!1)},unbind:function(t){t.removeEventListener("click",t[a].removeHandle,!1),t[a]=null,delete t[a]}},o=function(t){t.directive("waves",s)};window.Vue&&(window.waves=s,Vue.use(o)),s.install=o;e["a"]=s},"838f":function(t,e,n){"use strict";n.d(e,"b",(function(){return i})),n.d(e,"d",(function(){return s})),n.d(e,"c",(function(){return o})),n.d(e,"a",(function(){return r}));var a=n("b775");function i(t){return Object(a["a"])({url:"/api/v1/admin/appeal",method:"get",params:t})}function s(t,e){return Object(a["a"])({url:"/api/v1/admin/appeal/"+e,method:"put",data:t})}function o(t){return Object(a["a"])({url:"/api/v1/article/pv",method:"get",params:{pv:t}})}function r(t){return Object(a["a"])({url:"/api/v1/article/create",method:"post",data:t})}},"8d41":function(t,e,n){},c507:function(t,e,n){},ebfc:function(t,e,n){"use strict";n.r(e);var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"app-container"},[n("h1",[t._v(t._s(t.voting.title))]),t._v(" "),n("div",{staticClass:"filter-container"},[n("el-button",{directives:[{name:"waves",rawName:"v-waves"}],staticClass:"filter-item",attrs:{type:"primary",icon:"el-icon-plus"},on:{click:t.handleFilter}},[t._v("\n      Проголосовать\n    ")])],1),t._v(" "),n("el-tabs",{attrs:{type:"border-card"}},[n("el-tab-pane",{attrs:{label:"Результат"}},[n("el-tag",{attrs:{type:t._f("statusColorFilter")(t.voting.status)}},[t._v("\n        "+t._s(t._f("statusFilter")(t.voting.status))+"\n      ")]),t._v(" "),t._l(t.voting.questions,(function(e,a){return n("div",{staticClass:"question"},[n("div",{staticStyle:{"padding-bottom":"5px",color:"black","font-weight":"600"}},[t._v(t._s(a+1)+".\n        "),n("span",[t._v(" "+t._s(e.text))])]),t._v(" "),n("div",{staticStyle:{"padding-bottom":"5px"}},[t._v("Проголосовало "+t._s((100*e.answersCount/t.voting.steadsCount).toFixed(2))+"%  ("+t._s(e.answersCount)+" участков)")]),t._v(" "),t._l(e.answers,(function(a,i){return n("div",[n("div",{staticClass:"answer"},[n("div",{staticClass:"an",style:t._f("resultBackgroundFilter")(a,e)},[t._v("\n          "+t._s(i+1)+"."),n("span",[t._v(t._s(a.text)+" ")]),t._v(" "),n("span",[t._v(t._s(a.userAnswersCount)+" ")]),n("span",[t._v(" ("+t._s(t._f("resultFilter")(a,e))+"%)")])])])])}))],2)}))],2),t._v(" "),n("el-tab-pane",{attrs:{label:"Участки"}},[n("SteadOwnwer",{attrs:{questions:t.voting.questions}})],1),t._v(" "),n("el-tab-pane",{attrs:{label:"Описание"}},[n("div",{staticClass:"question",domProps:{innerHTML:t._s(t.voting.description)}}),t._v(" "),t.voting.files.length>0?n("div",{staticClass:"question"},[n("div",{staticClass:"file-list-header"},[t._v("Файлы:")]),t._v(" "),n("ul",t._l(t.voting.files,(function(e){return n("li",[t._v(t._s(e.name)+"\n            "),n("span",{staticClass:"file-size"},[t._v(t._s(t._f("sizeFilter")(e.size)))]),t._v(" "),n("el-link",{attrs:{href:t._f("urlFilter")(e.id),type:"success"}},[t._v("Скачать")])],1)})),0)]):t._e()])],1),t._v(" "),n("el-dialog",{attrs:{title:t.textMap[t.dialogStatus],visible:t.dialogFormVisible},on:{"update:visible":function(e){t.dialogFormVisible=e}}},[n("el-form",{ref:"dataForm",staticStyle:{width:"600px","margin-left":"100px"},attrs:{rules:t.rules,model:t.temp,"label-position":"left","label-width":"100px"}},[n("el-form-item",{attrs:{label:"Автор",prop:"user"}},[n("el-tag",[t._v(" "+t._s(t.temp.user.fullName)+" ")]),t._v(" "),n("el-tag",{attrs:{type:"info"}},[t._v(t._s(t._f("parseTime")(t.temp.created_at," {d}-{m}-{y} {h}:{i}")))])],1),t._v(" "),n("el-form-item",{attrs:{label:"Заголовок",prop:"title"}},[n("el-input",{attrs:{readonly:""},model:{value:t.temp.title,callback:function(e){t.$set(t.temp,"title",e)},expression:"temp.title"}})],1),t._v(" "),n("el-form-item",{attrs:{label:"Текст"}},[n("el-input",{attrs:{autosize:{minRows:2},type:"textarea",placeholder:"Нет теста =(",readonly:""},model:{value:t.temp.text,callback:function(e){t.$set(t.temp,"text",e)},expression:"temp.text"}}),t._v(" "),t._l(t.temp.message,(function(e){return n("div",{key:e.id,staticClass:"text item"},[n("el-avatar",{attrs:{size:30,src:e.user.avatar},on:{error:t.errorHandler}},[n("img",{attrs:{src:"/images/default-avatar.jpg"}})]),t._v("\n          "+t._s(e.user.last_name)+" "+t._s(e.user.name)+". "+t._s(e.user.middle_name)+". "+t._s(e.text)+"\n        ")],1)}))],2),t._v(" "),n("el-form-item",{attrs:{label:"Ответить"}},[n("el-input",{attrs:{autosize:{minRows:2,maxRows:4},type:"textarea",placeholder:"Введите сообщение для пользователя"},model:{value:t.temp.new_message,callback:function(e){t.$set(t.temp,"new_message",e)},expression:"temp.new_message"}})],1)],1),t._v(" "),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(e){t.dialogFormVisible=!1}}},[t._v("\n        Отмена\n      ")]),t._v(" "),n("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.updateData()}}},[t._v("\n        Отправить\n      ")])],1)],1),t._v(" "),n("el-dialog",{attrs:{visible:t.dialogPvVisible,title:"Reading statistics"},on:{"update:visible":function(e){t.dialogPvVisible=e}}},[n("el-table",{staticStyle:{width:"100%"},attrs:{data:t.pvData,border:"",fit:"","highlight-current-row":""}},[n("el-table-column",{attrs:{prop:"key",label:"Channel"}}),t._v(" "),n("el-table-column",{attrs:{prop:"pv",label:"Pv"}})],1),t._v(" "),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{attrs:{type:"primary"},on:{click:function(e){t.dialogPvVisible=!1}}},[t._v("Confirm")])],1)],1)],1)},i=[],s=(n("20d6"),n("28a5"),n("838f")),o=n("44af"),r=n("6724"),l=n("ed08"),u=n("333d"),c=function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.listLoading?n("div",[n("el-table",{key:t.tableKey,staticStyle:{width:"100%"},attrs:{data:t.steads,border:"",fit:"","highlight-current-row":""}},[n("el-table-column",{attrs:{label:"участок",align:"center",width:"80"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[n("span",{class:{red:!t.listo[a.id],green:t.listo[a.id]}},[t._v(t._s(a.number))])]}}],null,!1,549198970)}),t._v(" "),t._l(t.questions,(function(e){return n("el-table-column",{key:e.id,attrs:{label:e.text,align:"center"}},t._l(e.answers,(function(a){return n("el-table-column",{key:a.id,attrs:{label:a.text,align:"center"},scopedSlots:t._u([{key:"default",fn:function(i){var s=i.row;return[t.listo[s.id]&&t.listo[s.id][e.id]==a.id?n("span",{staticStyle:{color:"green","font-size":"2em"}},[n("i",{staticClass:"el-icon-success"})]):t._e()]}}],null,!0)})})),1)}))],2)],1):t._e()},d=[],p=n("bd86"),m=(n("ac6a"),n("2b9a")),f={props:{questions:{type:Array,defaults:[]}},data:function(){return{list:[],listo:{},tableKey:0,listLoading:!1,steads:{},voting:[]}},mounted:function(){this.getSteads()},methods:{getSteads:function(){var t=this,e={limit:1e3};Object(m["b"])(e).then((function(e){e.data.data.forEach((function(e){t.steads[e.id]=e.number})),t.steads=e.data.data,console.log(t.steads),t.listLoading=!0}))},getList:function(){var t={};for(var e in this.questions.forEach((function(e){e.answers.forEach((function(e){e.userAnswers.forEach((function(e){var n;e.stead_id in t?t[e.stead_id][e.question_id]=e.answer_id:t[e.stead_id]=(n={},Object(p["a"])(n,e.question_id,e.answer_id),Object(p["a"])(n,"user_id",e.user_id),n)}))}))})),console.log(this.list),this.listo=t,t)this.list.push({id:e,quest:t[e]});this.tableKey+=1}},watch:{questions:function(t){console.log("watch"),console.log(t),this.getList()}}},v=f,h=(n("667e"),n("2877")),g=Object(h["a"])(v,c,d,!1,null,"63c1f25c",null),b=g.exports,_=[{key:"CN",display_name:"China"},{key:"US",display_name:"USA"},{key:"JP",display_name:"Japan"},{key:"EU",display_name:"Eurozone"}],y=[{key:"other",display_name:"Прочее"},{key:"stead",display_name:"Участок"}],w=y.reduce((function(t,e){return t[e.key]=e.display_name,t}),{}),k=(_.reduce((function(t,e){return t[e.key]=e.display_name,t}),{}),[{key:"new",display_name:"Новое"},{key:"execution",display_name:"Идет"},{key:"done",display_name:"Законченно"},{key:"cancel",display_name:"Отмененное"}]),x=k.reduce((function(t,e){return t[e.key]=e.display_name,t}),{}),O={name:"AdminVotingResult",components:{Pagination:u["a"],SteadOwnwer:b},directives:{waves:r["a"]},filters:{statusColorFilter:function(t){var e={new:"info",execution:"",done:"success",cancel:"danger"};return e[t]},urlFilter:function(t){return"http://beta-lomo.posiyans.ru/user/storage/file/"+t},resultFilter:function(t,e){console.log(e);var n=e.answers.reduce((function(t,e){return t+e.userAnswersCount}),0);return(100*t.userAnswersCount/n).toFixed(2)},resultBackgroundFilter:function(t,e){console.log(e);var n=e.answers.reduce((function(t,e){return t+e.userAnswersCount}),0);return"width:"+600*t.userAnswersCount/n+"px;"},statusFilter:function(t){return x[t]},typeFilter:function(t){var e=t.split("_");return e[1]in w?w[e[1]]:"Другое"}},data:function(){return{tabActive:1,id:this.$route.params&&this.$route.params.id,voting:{files:[]},tableKey:0,list:null,total:0,listLoading:!0,listQuery:{page:1,limit:20,importance:void 0,title:void 0,type:void 0,status:"open",sort:"+created_at"},importanceOptions:[1,2,3],calendarTypeOptions:_,selectStatusOptions:k,appealTypeObject:y,sortOptions:[{label:"ID Ascending",key:"+id"},{label:"ID Descending",key:"-id"}],statusOptions:["published","draft","deleted"],temp:{id:void 0,user:{},importance:1,new_message:"",timestamp:new Date,title:"",type:"",status:"published"},dialogFormVisible:!1,dialogStatus:"",textMap:{update:"Edit",create:"Create",show:"Обращение"},dialogPvVisible:!1,pvData:[],rules:{},downloadLoading:!1}},mounted:function(){this.getVoting()},methods:{getVoting:function(){var t=this;this.listLoading=!0,Object(o["c"])(this.id,this.listQuery).then((function(e){console.log(e.data),t.voting=e.data.data}))},handleFilter:function(){this.listQuery.page=1,this.getVoting()},handleModifyStatus:function(t,e){var n=this;t.status=e;var a={appeal:t};Object(s["d"])(a,t.id).then((function(t){console.log(t.data),n.$message({message:"Success",type:"success"})}))},sortChange:function(t){var e=t.prop,n=t.order;"created_at"===e&&this.sortByID(n)},sortByID:function(t){console.log(t),this.listQuery.sort="ascending"===t?"+created_at":"descending"===t?"-created_at":"",this.handleFilter()},resetTemp:function(){this.temp={id:void 0,user:{},importance:1,remark:"",timestamp:new Date,title:"",status:"published",type:""}},createData:function(){var t=this;this.$refs["dataForm"].validate((function(e){e&&(t.temp.id=parseInt(100*Math.random())+1024,t.temp.author="vue-element-admin",Object(s["a"])(t.temp).then((function(){t.list.unshift(t.temp),t.dialogFormVisible=!1,t.$notify({title:"Success",message:"Created Successfully",type:"success",duration:2e3})})))}))},handleUpdate:function(t){var e=this;this.temp=Object.assign({},t),this.temp.timestamp=new Date(this.temp.timestamp),this.dialogStatus="update",this.dialogFormVisible=!0,this.$nextTick((function(){e.$refs["dataForm"].clearValidate()}))},handleShow:function(t){var e=this;this.temp=Object.assign({},t),this.temp.timestamp=new Date(this.temp.timestamp),this.dialogStatus="show",this.dialogFormVisible=!0,this.$nextTick((function(){e.$refs["dataForm"].clearValidate()}))},updateData:function(){var t=this,e={appeal:this.temp};Object(s["d"])(e,this.temp.id).then((function(e){var n=t.list.findIndex((function(e){return e.id===t.temp.id}));t.temp.message.push({text:t.temp.new_message,user:{name:"я"}}),t.temp.new_message="",t.list.splice(n,1,t.temp),console.log(e.data),t.dialogFormVisible=!1,t.$notify({title:"Success",message:"Update Successfully",type:"success",duration:2e3})}))},handleDelete:function(t,e){this.$notify({title:"Success",message:"Delete Successfully",type:"success",duration:2e3}),this.list.splice(e,1)},handleFetchPv:function(t){var e=this;Object(s["c"])(t).then((function(t){e.pvData=t.data.pvData,e.dialogPvVisible=!0}))},handleDownload:function(){var t=this;this.downloadLoading=!0,Promise.all([n.e("chunk-5bdd67a2"),n.e("chunk-2d3eea4a"),n.e("chunk-58293907")]).then(n.bind(null,"4bf8d")).then((function(e){var n=["timestamp","title","type","importance","status"],a=["timestamp","title","type","importance","status"],i=t.formatJson(a);e.export_json_to_excel({header:n,data:i,filename:"table-list"}),t.downloadLoading=!1}))},formatJson:function(t){return this.list.map((function(e){return t.map((function(t){return"timestamp"===t?Object(l["d"])(e[t]):e[t]}))}))}}},C=O,F=(n("62e3"),Object(h["a"])(C,a,i,!1,null,"84d3ea7c",null));e["default"]=F.exports}}]);